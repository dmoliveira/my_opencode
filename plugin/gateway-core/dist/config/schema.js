// Defines safe gateway defaults for production usage.
export const DEFAULT_GATEWAY_CONFIG = {
    hooks: {
        enabled: true,
        disabled: [],
        order: [
            "autopilot-loop",
            "continuation",
            "tool-output-truncator",
            "semantic-output-summarizer",
            "context-window-monitor",
            "preemptive-compaction",
            "global-process-pressure",
            "pressure-escalation-guard",
            "session-recovery",
            "delegate-task-retry",
            "validation-evidence-ledger",
            "parallel-opportunity-detector",
            "read-budget-optimizer",
            "adaptive-validation-scheduler",
            "stop-continuation-guard",
            "keyword-detector",
            "think-mode",
            "thinking-block-validator",
            "auto-slash-command",
            "compaction-context-injector",
            "context-injector",
            "rules-injector",
            "directory-agents-injector",
            "directory-readme-injector",
            "noninteractive-shell-guard",
            "write-existing-file-guard",
            "agent-reservation-guard",
            "subagent-question-blocker",
            "tasks-todowrite-disabler",
            "task-resume-info",
            "todo-continuation-enforcer",
            "compaction-todo-preserver",
            "empty-task-response-detector",
            "edit-error-recovery",
            "json-error-recovery",
            "provider-token-limit-recovery",
            "hashline-read-enhancer",
            "max-step-recovery",
            "mode-transition-reminder",
            "todoread-cadence-reminder",
            "provider-retry-backoff-guidance",
            "provider-error-classifier",
            "comment-checker",
            "agent-user-reminder",
            "unstable-agent-babysitter",
            "question-label-truncator",
            "dangerous-command-guard",
            "secret-leak-guard",
            "secret-commit-guard",
            "workflow-conformance-guard",
            "scope-drift-guard",
            "done-proof-enforcer",
            "dependency-risk-guard",
            "docs-drift-guard",
            "hook-test-parity-guard",
            "retry-budget-guard",
            "stale-loop-expiry-guard",
            "parallel-writer-conflict-guard",
            "branch-freshness-guard",
            "pr-readiness-guard",
            "pr-body-evidence-guard",
            "merge-readiness-guard",
            "gh-checks-merge-guard",
            "post-merge-sync-guard",
            "safety",
        ],
    },
    autopilotLoop: {
        enabled: true,
        maxIterations: 0,
        orphanMaxAgeHours: 12,
        bootstrapFromRuntimeOnIdle: false,
        maxIgnoredCompletionCycles: 1,
        completionMode: "promise",
        completionPromise: "DONE",
    },
    toolOutputTruncator: {
        enabled: true,
        maxChars: 12000,
        maxLines: 220,
        tools: ["bash", "Bash", "read", "Read", "grep", "Grep", "webfetch", "WebFetch", "glob", "Glob"],
    },
    contextWindowMonitor: {
        enabled: true,
        warningThreshold: 0.7,
        reminderCooldownToolCalls: 12,
        minTokenDeltaForReminder: 25_000,
        defaultContextLimitTokens: 128_000,
        guardMarkerMode: "both",
        guardVerbosity: "normal",
        maxSessionStateEntries: 512,
    },
    preemptiveCompaction: {
        enabled: true,
        warningThreshold: 0.78,
        compactionCooldownToolCalls: 10,
        minTokenDeltaForCompaction: 35_000,
        defaultContextLimitTokens: 128_000,
        guardMarkerMode: "both",
        guardVerbosity: "normal",
        maxSessionStateEntries: 512,
    },
    compactionContextInjector: {
        enabled: true,
    },
    globalProcessPressure: {
        enabled: true,
        checkCooldownToolCalls: 3,
        reminderCooldownToolCalls: 6,
        criticalReminderCooldownToolCalls: 10,
        criticalEscalationWindowToolCalls: 25,
        criticalPauseAfterEvents: 1,
        criticalEscalationAfterEvents: 3,
        warningContinueSessions: 5,
        warningOpencodeProcesses: 10,
        warningMaxRssMb: 1400,
        criticalMaxRssMb: 10_240,
        autoPauseOnCritical: true,
        notifyOnCritical: true,
        guardMarkerMode: "both",
        guardVerbosity: "normal",
        maxSessionStateEntries: 1024,
    },
    pressureEscalationGuard: {
        enabled: true,
        maxContinueBeforeBlock: 5,
        blockedSubagentTypes: ["reviewer", "verifier", "explore", "librarian", "general"],
        allowPromptPatterns: ["blocker", "critical", "sev0", "sev1", "check failed", "pressure-override"],
    },
    sessionRecovery: {
        enabled: true,
        autoResume: true,
    },
    delegateTaskRetry: {
        enabled: true,
    },
    validationEvidenceLedger: {
        enabled: true,
    },
    parallelOpportunityDetector: {
        enabled: true,
    },
    readBudgetOptimizer: {
        enabled: true,
        smallReadLimit: 80,
        maxConsecutiveSmallReads: 3,
    },
    adaptiveValidationScheduler: {
        enabled: true,
        reminderEditThreshold: 3,
    },
    stopContinuationGuard: {
        enabled: true,
    },
    keywordDetector: {
        enabled: true,
    },
    thinkMode: {
        enabled: true,
    },
    thinkingBlockValidator: {
        enabled: true,
    },
    autoSlashCommand: {
        enabled: true,
    },
    rulesInjector: {
        enabled: true,
    },
    directoryAgentsInjector: {
        enabled: true,
        maxChars: 4000,
    },
    directoryReadmeInjector: {
        enabled: true,
        maxChars: 4000,
    },
    noninteractiveShellGuard: {
        enabled: true,
        injectEnvPrefix: true,
        envPrefixes: [
            "CI=true",
            "DEBIAN_FRONTEND=noninteractive",
            "GIT_TERMINAL_PROMPT=0",
            "GIT_EDITOR=true",
            "GIT_PAGER=cat",
            "PAGER=cat",
            "GCM_INTERACTIVE=never",
            "HOMEBREW_NO_AUTO_UPDATE=1",
            "npm_config_yes=true",
            "PIP_NO_INPUT=1",
            "YARN_ENABLE_IMMUTABLE_INSTALLS=false",
        ],
        prefixCommands: ["git", "gh"],
        blockedPatterns: [
            "\\b(vim|vi|nano|emacs|less|more|man)\\b",
            "\\bgit\\s+add\\s+-p\\b",
            "\\bgit\\s+rebase\\s+-i\\b",
        ],
    },
    writeExistingFileGuard: {
        enabled: true,
    },
    agentReservationGuard: {
        enabled: true,
        enforce: false,
        reservationEnvKeys: ["AGENTMAIL_RESERVATION_ACTIVE", "MY_OPENCODE_FILE_RESERVATION_ACTIVE"],
    },
    subagentQuestionBlocker: {
        enabled: true,
        sessionPatterns: ["task-", "subagent"],
    },
    tasksTodowriteDisabler: {
        enabled: true,
    },
    taskResumeInfo: {
        enabled: true,
    },
    todoContinuationEnforcer: {
        enabled: true,
        cooldownMs: 30000,
        maxConsecutiveFailures: 5,
    },
    compactionTodoPreserver: {
        enabled: true,
        maxChars: 4000,
    },
    emptyTaskResponseDetector: {
        enabled: true,
    },
    editErrorRecovery: {
        enabled: true,
    },
    jsonErrorRecovery: {
        enabled: true,
    },
    providerTokenLimitRecovery: {
        enabled: true,
        cooldownMs: 60000,
    },
    hashlineReadEnhancer: {
        enabled: true,
    },
    maxStepRecovery: {
        enabled: true,
    },
    modeTransitionReminder: {
        enabled: true,
    },
    todoreadCadenceReminder: {
        enabled: true,
        cooldownEvents: 2,
    },
    providerRetryBackoffGuidance: {
        enabled: true,
        cooldownMs: 30000,
    },
    providerErrorClassifier: {
        enabled: true,
        cooldownMs: 30000,
    },
    commentChecker: {
        enabled: true,
    },
    agentUserReminder: {
        enabled: true,
    },
    unstableAgentBabysitter: {
        enabled: true,
        riskyPatterns: ["experimental", "preview", "unstable"],
    },
    questionLabelTruncator: {
        enabled: true,
        maxLength: 30,
    },
    semanticOutputSummarizer: {
        enabled: true,
        minChars: 20000,
        minLines: 400,
        maxSummaryLines: 8,
    },
    dangerousCommandGuard: {
        enabled: true,
        blockedPatterns: [
            "\\brm\\s+-rf\\b",
            "\\bgit\\s+reset\\s+--hard\\b",
            "\\bgit\\s+checkout\\s+--\\b",
            "\\bgit\\s+clean\\s+-fdx\\b",
            "\\bgit\\s+push\\s+--force\\b",
            "curl\\s+[^|]+\\|\\s*bash",
        ],
    },
    secretLeakGuard: {
        enabled: true,
        redactionToken: "[REDACTED_SECRET]",
        patterns: [
            "sk-[A-Za-z0-9]{20,}",
            "ghp_[A-Za-z0-9]{20,}",
            "AIza[0-9A-Za-z\\-_]{20,}",
            "-----BEGIN (RSA|EC|OPENSSH|DSA|PRIVATE) KEY-----",
            "(?i)(api[_-]?key|token|secret|password)\\s*[:=]\\s*['\"]?[A-Za-z0-9_\\-]{12,}",
        ],
    },
    workflowConformanceGuard: {
        enabled: true,
        protectedBranches: ["main", "master"],
        blockEditsOnProtectedBranches: true,
    },
    scopeDriftGuard: {
        enabled: false,
        allowedPaths: [],
        blockOnDrift: true,
    },
    doneProofEnforcer: {
        enabled: true,
        requiredMarkers: ["validation", "test", "lint"],
        requireLedgerEvidence: true,
        allowTextFallback: true,
    },
    dependencyRiskGuard: {
        enabled: true,
        lockfilePatterns: ["package-lock.json", "pnpm-lock.yaml", "yarn.lock", "poetry.lock", "uv.lock", "Cargo.lock"],
        commandPatterns: [
            "\\bnpm\\s+(install|update|uninstall|audit\\s+fix)\\b",
            "\\bpnpm\\s+(install|update|remove|audit)\\b",
            "\\byarn\\s+(add|remove|upgrade|install)\\b",
            "\\bbun\\s+add\\b",
            "\\buv\\s+(add|remove|sync)\\b",
            "\\bcargo\\s+(add|remove|update)\\b",
        ],
    },
    docsDriftGuard: {
        enabled: true,
        sourcePatterns: ["plugin/gateway-core/src/**", "plugin/gateway-core/package.json"],
        docsPatterns: ["README.md", "docs/**", "plugin/gateway-core/**/*.md"],
        blockOnDrift: false,
    },
    hookTestParityGuard: {
        enabled: true,
        sourcePatterns: ["plugin/gateway-core/src/hooks/**/*.ts"],
        testPatterns: ["plugin/gateway-core/test/*-hook.test.mjs"],
        blockOnMismatch: true,
    },
    retryBudgetGuard: {
        enabled: true,
        maxRetries: 3,
    },
    staleLoopExpiryGuard: {
        enabled: true,
        maxAgeMinutes: 120,
    },
    branchFreshnessGuard: {
        enabled: true,
        baseRef: "origin/main",
        maxBehind: 0,
        enforceOnPrCreate: true,
        enforceOnPrMerge: true,
    },
    prReadinessGuard: {
        enabled: true,
        requireCleanWorktree: true,
        requireValidationEvidence: true,
    },
    prBodyEvidenceGuard: {
        enabled: true,
        requireSummarySection: true,
        requireValidationSection: true,
        requireValidationEvidence: true,
        allowUninspectableBody: true,
    },
    mergeReadinessGuard: {
        enabled: true,
        requireDeleteBranch: true,
        requireStrategy: true,
        disallowAdminBypass: true,
    },
    ghChecksMergeGuard: {
        enabled: true,
        blockDraft: true,
        requireApprovedReview: true,
        requirePassingChecks: true,
        blockedMergeStates: ["BEHIND", "BLOCKED", "DIRTY"],
        failOpenOnError: false,
    },
    postMergeSyncGuard: {
        enabled: true,
        requireDeleteBranch: true,
        enforceMainSyncInline: false,
        reminderCommands: ["git checkout main", "git pull --rebase"],
    },
    parallelWriterConflictGuard: {
        enabled: true,
        maxConcurrentWriters: 2,
        writerCountEnvKeys: ["MY_OPENCODE_ACTIVE_WRITERS", "AGENTMAIL_ACTIVE_WRITERS"],
        reservationPathsEnvKeys: ["MY_OPENCODE_FILE_RESERVATION_PATHS", "AGENTMAIL_RESERVATION_PATHS"],
        activeReservationPathsEnvKeys: ["MY_OPENCODE_ACTIVE_RESERVATION_PATHS", "AGENTMAIL_ACTIVE_RESERVATION_PATHS"],
        enforceReservationCoverage: true,
    },
    secretCommitGuard: {
        enabled: true,
        patterns: [
            "sk-[A-Za-z0-9]{20,}",
            "ghp_[A-Za-z0-9]{20,}",
            "AIza[0-9A-Za-z\\-_]{20,}",
            "-----BEGIN (RSA|EC|OPENSSH|DSA|PRIVATE) KEY-----",
            "(?i)(api[_-]?key|token|secret|password)\\s*[:=]\\s*['\"]?[A-Za-z0-9_\\-]{12,}",
        ],
    },
    quality: {
        profile: "fast",
        ts: {
            lint: true,
            typecheck: true,
            tests: false,
        },
        py: {
            selftest: true,
        },
    },
};
