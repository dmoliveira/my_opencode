# v0.9 Claude-Flow Upgrades Plan

## Goal

Add high-leverage Claude-style execution workflows while preserving canonical command names and deterministic guardrails.

## Status Legend

- [ ] pending
- [-] in progress
- [x] done
- [!] blocked

## Validation Gates

- `make validate`
- `make selftest`
- `make install-test`
- `pre-commit run --all-files`

## End-to-End WT Flow

- [ ] Create one feature branch per epic (`feat/v0-9-<epic-slug>`)
- [ ] Implement scoped changes (command/runtime + docs + selftest)
- [ ] Run full validation gates
- [ ] Commit with concise why-focused message
- [ ] Push branch + open PR
- [ ] Merge PR and return to clean `main`
- [ ] Update this plan worklog and epic checkboxes

## Worklog

| UTC | Task | Status | Notes |
|---|---|---|---|
| 2026-02-24T10:35:00Z | Plan scaffold | done | Opened v0.9 tracking plan for Claude-style flow upgrades. |
| 2026-02-24T10:55:00Z | E1 checkpoint UX | done | Added `/checkpoint create|restore` with force + run-id mismatch guardrails, docs index update, and selftest coverage. |
| 2026-02-24T11:00:00Z | E2 plan-run contracts | done | Added `/plan run|status|doctor` with required contract section checks and deterministic start-work delegation coverage. |
| 2026-02-24T11:10:00Z | E3 local review pass | done | Added `/review local|doctor` structured correctness/risk/tests/docs/migration diagnostics with remediation hints and selftest coverage. |
| 2026-02-24T11:20:00Z | E4 smart resume triage | done | Added `/resume smart` triage bundle with reason summaries, likely fix paths, and recovery next-step diagnostics. |
| 2026-02-24T11:30:00Z | E5 change narrative | done | Added `/changes explain` narrative output (`why|risk|verify`) from git/diff evidence with selftest coverage. |
| 2026-02-24T11:40:00Z | E6 intent router hardening | done | Added `/do` and `/ship` intent routes with deterministic safety-gated behavior and selftest coverage. |

## Epics

### E1 Checkpoint UX (`/checkpoint create|restore`)

- [x] Add first-class create/restore UX for rollback before risky edits
- [x] Add safety checks for restore scope and overwrite behavior
- [x] Add docs + selftest coverage for checkpoint flow

### E2 Plan-Run Contracts (`/plan run`)

- [x] Add execution contract schema (objective/scope/acceptance/stop conditions)
- [x] Add `/plan run` command surface using existing deterministic runtime paths
- [x] Add docs + selftest coverage for contract enforcement

### E3 Local Review Pass (`/review local`)

- [x] Add local review command for correctness/risk/tests/docs/migration checks
- [x] Emit structured findings with severity + remediation hints
- [x] Add docs + selftest coverage for pre-PR review flow

### E4 Smart Resume Triage (`/resume smart`)

- [x] Add failure triage bundle (failing command/root-cause guess/fix paths)
- [x] Integrate with existing resume/recovery guardrails
- [x] Add docs + selftest coverage for deterministic recovery behavior

### E5 Change Narrative (`/changes explain`)

- [x] Add concise human-readable change narrative from local git evidence
- [x] Include why/risk/verify sections optimized for handoff and release notes
- [x] Add docs + selftest coverage for output schema and examples

### E6 Intent Router Hardening (`/do|/ship|/hotfix`)

- [x] Add high-level intent aliases mapped to canonical deterministic flows
- [x] Enforce safety gates (validation evidence, PR/body template, reason codes)
- [x] Add docs + selftest coverage for intent-to-workflow routing

## Handoff Notes

- Keep command surface lean; avoid legacy alias restoration.
- Each epic updates `opencode.json`, `docs/command-handbook.md`, and `scripts/selftest.py` when command behavior changes.
- Merge in small, scoped PRs and update worklog after each merged epic.
