# v0.9 Claude-Flow Upgrades Plan

## Goal

Add high-leverage Claude-style execution workflows while preserving canonical command names and deterministic guardrails.

## Status Legend

- [ ] pending
- [-] in progress
- [x] done
- [!] blocked

## Validation Gates

- `make validate`
- `make selftest`
- `make install-test`
- `pre-commit run --all-files`

## End-to-End WT Flow

- [ ] Create one feature branch per epic (`feat/v0-9-<epic-slug>`)
- [ ] Implement scoped changes (command/runtime + docs + selftest)
- [ ] Run full validation gates
- [ ] Commit with concise why-focused message
- [ ] Push branch + open PR
- [ ] Merge PR and return to clean `main`
- [ ] Update this plan worklog and epic checkboxes

## Worklog

| UTC | Task | Status | Notes |
|---|---|---|---|
| 2026-02-24T10:35:00Z | Plan scaffold | done | Opened v0.9 tracking plan for Claude-style flow upgrades. |

## Epics

### E1 Checkpoint UX (`/checkpoint create|restore`)

- [ ] Add first-class create/restore UX for rollback before risky edits
- [ ] Add safety checks for restore scope and overwrite behavior
- [ ] Add docs + selftest coverage for checkpoint flow

### E2 Plan-Run Contracts (`/plan run`)

- [ ] Add execution contract schema (objective/scope/acceptance/stop conditions)
- [ ] Add `/plan run` command surface using existing deterministic runtime paths
- [ ] Add docs + selftest coverage for contract enforcement

### E3 Local Review Pass (`/review local`)

- [ ] Add local review command for correctness/risk/tests/docs/migration checks
- [ ] Emit structured findings with severity + remediation hints
- [ ] Add docs + selftest coverage for pre-PR review flow

### E4 Smart Resume Triage (`/resume smart`)

- [ ] Add failure triage bundle (failing command/root-cause guess/fix paths)
- [ ] Integrate with existing resume/recovery guardrails
- [ ] Add docs + selftest coverage for deterministic recovery behavior

### E5 Change Narrative (`/changes explain`)

- [ ] Add concise human-readable change narrative from local git evidence
- [ ] Include why/risk/verify sections optimized for handoff and release notes
- [ ] Add docs + selftest coverage for output schema and examples

### E6 Intent Router Hardening (`/do|/ship|/hotfix`)

- [ ] Add high-level intent aliases mapped to canonical deterministic flows
- [ ] Enforce safety gates (validation evidence, PR/body template, reason codes)
- [ ] Add docs + selftest coverage for intent-to-workflow routing

## Handoff Notes

- Keep command surface lean; avoid legacy alias restoration.
- Each epic updates `opencode.json`, `docs/command-handbook.md`, and `scripts/selftest.py` when command behavior changes.
- Merge in small, scoped PRs and update worklog after each merged epic.
