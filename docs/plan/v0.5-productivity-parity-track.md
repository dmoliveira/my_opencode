# v0.5 Productivity Parity Track (Claude-Flow Inspired, Canonical Surface)

## Scope

Build high-value productivity features without legacy alias restoration:

1. issue claims + handoff
2. workflow engine
3. daemon/statusline observability
4. agent pool lifecycle
5. memory lifecycle ops
6. hook-level risk/routing/outcome learning loop

## Status Legend

- pending
- in progress
- done
- blocked

## Global Validation Gates

- `make validate`
- `make selftest`
- `make install-test`
- `pre-commit run --all-files`

## Worklog

| UTC | Task | Status | Notes |
|---|---|---|---|
| 2026-02-24T00:00:00Z | Track created | done | Canonical local-first implementation selected (`1`). |
| 2026-02-24T00:20:00Z | E1 issue claims + handoff | done | Added `/claims` with claim/handoff/release/status/list/doctor + stale detection. |
| 2026-02-24T00:22:00Z | E2 workflow engine | done | Added `/workflow` with run/validate/list/status/stop/template/doctor on local templates. |
| 2026-02-24T00:24:00Z | E3 daemon observability | done | Added `/daemon` start/stop/status/summary/doctor with interval state tracking. |
| 2026-02-24T00:26:00Z | E4 agent pool lifecycle | done | Added `/agent-pool` spawn/list/health/drain/logs/doctor lifecycle controls. |
| 2026-02-24T00:28:00Z | E5 memory lifecycle ops | done | Added `/memory-lifecycle` stats/cleanup/compress/export/import/doctor. |
| 2026-02-24T00:30:00Z | E6 hook learning loop | done | Added `/hook-learning` pre/post risk/outcome capture + route/metrics/doctor. |
| 2026-02-24T00:33:00Z | Validation gates | done | Passed `make validate`, `make selftest`, `make install-test`, `pre-commit run --all-files`. |
| 2026-02-24T00:45:00Z | Phase 2 start | in progress | Extend workflow with per-step execution results and claims with handoff acceptance/rejection + stale expiry actions. |
| 2026-02-24T06:15:00Z | Phase 3 follow-up | done | Added daemon tick stale-claim automation, claims role-based auto-assignment via agent-pool, workflow `--execute` guarded command backend, and dependency-aware ordering. |

## Tasks

### E1 Issue Claims + Handoff

- [x] Define claim data model + persistence
- [x] Add command surface (canonical, no legacy aliases)
- [x] Add handoff transitions + stale claim release
- [x] Add doctor/health integration
- [x] Add selftest + install coverage

### E2 Workflow Engine

- [x] Define workflow schema + templates directory
- [x] Add `run|validate|list|status|stop`
- [x] Integrate with existing `/autoflow` state conventions
- [x] Add deterministic failure reason codes
- [x] Add selftest + install coverage

### E3 Daemon + Statusline

- [x] Add daemon manager (start/stop/status)
- [x] Add periodic metrics collector
- [x] Add statusline summary command
- [x] Add safe fallback when daemon unavailable
- [x] Add selftest + install coverage

### E4 Agent Pool Lifecycle

- [x] Add pool state model (capacity/health/assignment)
- [x] Add command surface (`spawn|list|health|logs|drain`)
- [x] Integrate with claims/workflow execution
- [x] Add doctor checks
- [x] Add selftest + install coverage

### E5 Memory Lifecycle

- [x] Add memory export/import format
- [x] Add cleanup/compress ops
- [x] Add stats and safety confirmation checks
- [x] Add doctor checks + quick fixes
- [x] Add selftest coverage

### E6 Hook Learning Loop

- [x] Add pre-command risk scoring hook
- [x] Add post-command outcome learning hook
- [x] Add route recommendation endpoint
- [x] Add metrics/reporting integration
- [x] Add selftest + install coverage

## Handoff Notes (for any AI)

- Maintain canonical command philosophy; do not add legacy aliases.
- Every command addition must update:
  - `opencode.json`
  - `docs/command-handbook.md`
  - `scripts/doctor_command.py` (if diagnosable)
  - `scripts/selftest.py`
- Keep commits small and scoped (1 epic per commit set).
- Run full validation gates after each epic.

## Phase 2 Enhancements

### P2-E1 Claims actions hardening

- [x] Add `accept-handoff` transition
- [x] Add `reject-handoff --reason` transition
- [x] Add `expire-stale --hours <n> --apply`
- [x] Add auto-expire scheduler integration into daemon loop

### P2-E2 Workflow execution depth

- [x] Add per-step execution records in `/workflow run` output
- [x] Persist completed/failed run records with step-level results
- [x] Add optional real command execution backend for step actions
- [x] Add DAG/dependency-aware step ordering
